<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    {% load static %}
   
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Elderly Care & Mindful Support Hub</title>
    
    <!-- Theme CSS -->
    <link rel="stylesheet" href="{% static 'css/theme.css' %}">
    <link rel="stylesheet" href="{% static 'css/dark-mode.css' %}">
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Other CSS -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/chat_modern.css' %}">
    <link rel="stylesheet" href="{% static 'css/chat_request_list.css' %}">
    <link rel="stylesheet" href="{% static 'css/chat_request_list_dark.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    
    <!-- Navbar Override CSS - Load last to ensure it takes precedence -->
    <!-- <link rel="stylesheet" href="{% static 'css/navbar_override.css' %}"> -->

    {% include "partials/css_variables.html" %}
    {% block extra_css %}{% endblock %}
    
    <!-- Theme initialization script -->
    <script>
        // Initialize theme before page load to prevent flash
        (function() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = savedTheme || (prefersDark ? 'dark' : 'light');
            document.documentElement.setAttribute('data-bs-theme', theme);
        })();
    </script>
    <link rel="icon" type="image/svg+xml" href="{% static 'images/admin-logo.svg' %}">
</head>
<body role="document">
 
    {% include "partials/navbar.html" %}
    
    <main id="main-content" class="py-4" role="main">
        {% block content %}{% endblock %}
    </main>
    
    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JavaScript -->
    <script src="{% static 'js/main.js' %}"></script>
    <!-- Notification Bell JS -->
    <script src="{% static 'js/navbar_medication_notifications.js' %}"></script>
    <script src="{% static 'js/theme_toggle.js' %}"></script>
    <script src="{% static 'js/clock.js' %}"></script>
    
    <script>
        window.CURRENT_USER_ID = "{{ user.id|default:'null' }}";
        if (window.CURRENT_USER_ID === "null" || window.CURRENT_USER_ID === "") {
            window.CURRENT_USER_ID = null;
        } else {
            window.CURRENT_USER_ID = parseInt(window.CURRENT_USER_ID, 10);
        }
    </script>
    
    <script src="{% static 'js/notification_system.js' %}"></script>
    <script src="{% static 'js/notification_ws.js' %}"></script>
    
    <!-- Notification Toast Container -->
    {% include "partials/toast.html" %}
    
    {% include "partials/user_vars.html" %}
    <script src="{% static 'js/notifications.js' %}"></script>
    <script src="{% static 'js/forum_notification_badge.js' %}"></script>
    <script src="{% static 'js/password_toggle.js' %}"></script>
    
    {% block extra_js %}{% endblock %}
    
    {% include "partials/footer.html" %}

<!-- Emergency Contacts Modal -->
<div class="modal fade" id="emergencyContactsModal" tabindex="-1" aria-labelledby="emergencyContactsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="emergencyContactsModalLabel"><i class="bi bi-telephone-fill me-2"></i>Emergency Contacts</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        {% if user.is_authenticated and emergency_contacts %}
          <ul class="list-group">
            {% for c in emergency_contacts %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <strong>{{ c.name }}</strong><br>
                  <small class="text-muted">{{ c.relationship }}</small>
                </div>
                <a href="tel:{{ c.phone }}" class="btn btn-outline-success btn-sm">
                  <i class="bi bi-telephone"></i> {{ c.phone }}
                </a>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="alert alert-warning text-center mb-0">
            <i class="bi bi-exclamation-triangle me-2"></i>No emergency contacts found. Please add contacts in your profile.
          </div>
        {% endif %}
      </div>
      <div class="modal-footer">
        <a href="{% url 'accounts:emergency_contacts' %}" class="btn btn-primary">
          <i class="bi bi-pencil-square me-1"></i>Manage Contacts
        </a>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
</body>
</html>


