<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <title>Elderly Care & Mindful Support Hub</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/chat_modern.css' %}">
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Animate.css for effects -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Dark Mode CSS -->
    <link rel="stylesheet" href="{% static 'css/dark-mode.css' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    {% include "partials/css_variables.html" %}
    {% block extra_css %}{% endblock %}

</head>
<body>
    {% include "partials/navbar.html" %}


    {% block content %}{% endblock %}

    {% include "partials/footer.html" %}

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JavaScript -->
    <script src="{% static 'js/main.js' %}"></script>
    {% block extra_js %}{% endblock %}
    
    <!-- Theme Toggle Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('theme-toggle');
            const htmlElement = document.documentElement;
            const darkIcon = document.querySelector('.theme-icon-dark');
            const lightIcon = document.querySelector('.theme-icon-light');
            
            // Function to set theme
            function setTheme(theme) {
                htmlElement.setAttribute('data-bs-theme', theme);
                localStorage.setItem('theme', theme);
                
                // Update button icons
                if (theme === 'dark') {
                    darkIcon.style.display = 'none';
                    lightIcon.style.display = 'inline-block';
                } else {
                    darkIcon.style.display = 'inline-block';
                    lightIcon.style.display = 'none';
                }
                
                // Ensure navbar is always visible regardless of theme
                const navbar = document.querySelector('.navbar');
                if (navbar) {
                    navbar.classList.add('navbar-dark');
                    navbar.classList.remove('navbar-light');
                }
            }
            
            // Check for saved theme preference or use user's system preference
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme) {
                setTheme(savedTheme);
            } else if (prefersDark) {
                setTheme('dark');
            } else {
                setTheme('light');
            }
            
            // Toggle theme when button is clicked
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    const currentTheme = htmlElement.getAttribute('data-bs-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    setTheme(newTheme);
                });
            }
        });
    </script>
    
    <!-- Real-time clock functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            function updateClock() {
                const clockElement = document.getElementById('current-time');
                if (!clockElement) return;
                
                const now = new Date();
                const userTimezone = clockElement.dataset.timezone;
                
                // Format hours, minutes, seconds with leading zeros
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                
                if (userTimezone) {
                    // Use user's timezone preference if available
                    try {
                        const tzOptions = {
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit',
                            hour12: false,
                            timeZone: userTimezone
                        };
                        clockElement.textContent = now.toLocaleTimeString(undefined, tzOptions);
                    } catch(e) {
                        // Fallback if timezone is invalid
                        clockElement.textContent = hours + ':' + minutes + ':' + seconds;
                    }
                } else {
                    // No user timezone preference, use local time
                    clockElement.textContent = hours + ':' + minutes + ':' + seconds;
                }
            }
            
            // Update clock immediately and then every second
            updateClock();
            setInterval(updateClock, 1000);
        });
    </script>
    
    <script>
        window.CURRENT_USER_ID = "{{ user.id|default:'null' }}";
        if (window.CURRENT_USER_ID === "null" || window.CURRENT_USER_ID === "") {
            window.CURRENT_USER_ID = null;
        } else {
            window.CURRENT_USER_ID = parseInt(window.CURRENT_USER_ID, 10);
        }
    </script>
    
    <script src="{% static 'js/notification_system.js' %}"></script>
    <script src="{% static 'js/notification_ws.js' %}"></script>
    <!-- Notification Toast Container -->
    {% include "partials/toast.html" %}

    {% include "partials/user_vars.html" %}
    <script src="{% static 'js/notifications.js' %}"></script>
    </body>
</html>
