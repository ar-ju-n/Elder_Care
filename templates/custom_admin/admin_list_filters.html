{% extends 'custom_admin/admin_base.html' %}
{% load admin_extras %}
{% block content %}
<div class="row">
    <div class="col-md-3">
        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-funnel me-2"></i>Filters</h5>
            </div>
            <div class="card-body">
                <form method="get" action="">
                    {% for field_name, filter_options in filters.items %}
                    <div class="mb-3">
                        <label for="id_{{ field_name }}" class="form-label">{{ field_name|title }}</label>
                        <select name="{{ field_name }}" id="id_{{ field_name }}" class="form-select">
                            <option value="">All</option>
                            {% for value, label in filter_options %}
                            <option value="{{ value }}" {% if request.GET.field_name == value %}selected{% endif %}>{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endfor %}
                    <button type="submit" class="btn btn-primary">Filter</button>
                    <a href="{{ request.path }}" class="btn btn-outline-secondary">Clear</a>
                </form>
            </div>
        </div>
        <div class="card shadow-sm">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0"><i class="bi bi-gear me-2"></i>Actions</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{{ add_url }}" class="btn btn-success">Add New</a>
                    <button type="button" class="btn btn-danger" id="bulkDeleteBtn" disabled>Delete Selected</button>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-9">
        <div class="card shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-table me-2"></i>{{ model_name }} List</h5>
                <span class="badge bg-primary">{{ objects.count }} items</span>
            </div>
            <div class="card-body">
                <form id="bulkActionForm" method="post" action="{% url 'custom_admin:admin_bulk_delete' app_label model_name %}">
                    {% csrf_token %}
                    <div class="table-responsive">
                        <table class="admin-table admin-table-striped">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAll"></th>
                                    {% for field in fields %}<th>{{ field|title }}</th>{% endfor %}
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for obj in objects %}
                                <tr>
                                    <td><input type="checkbox" name="selected_ids" value="{{ obj.id }}" class="object-checkbox"></td>
                                    {% for field in fields %}<td>{{ obj|get_field:field }}</td>{% endfor %}
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <a href="{% url 'custom_admin:admin_edit' app_label model_name obj.id %}" class="btn btn-warning">Edit</a>
                                            <a href="{% url 'custom_admin:admin_delete' app_label model_name obj.id %}" class="btn btn-danger">Delete</a>
                                        </div>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="{{ fields|length|add:2 }}" class="text-center">No items found</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const selectAll = document.getElementById('selectAll');
        const checkboxes = document.querySelectorAll('.object-checkbox');
        const bulkDeleteBtn = document.getElementById('bulkDeleteBtn');
        const bulkActionForm = document.getElementById('bulkActionForm');
        
        // Handle select all checkbox
        selectAll.addEventListener('change', function() {
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
            updateBulkDeleteButton();
        });
        
        // Handle individual checkboxes
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                updateBulkDeleteButton();
                // Update select all checkbox
                selectAll.checked = [...checkboxes].every(c => c.checked);
            });
        });
        
        // Update bulk delete button state
        function updateBulkDeleteButton() {
            const anyChecked = [...checkboxes].some(c => c.checked);
            bulkDeleteBtn.disabled = !anyChecked;
        }
        
        // Handle bulk delete button
        bulkDeleteBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to delete the selected items?')) {
                bulkActionForm.submit();
            }
        });
    });
</script>
{% endblock %}
